/*! AIOUploader - v0.1.0 - 2012-07-17
* http://github.com/chute/avatars-io-js/
* Copyright (c) 2012 Vadim Demedes; Licensed MIT */
(function(){function a(){typeof console!="undefined"&&typeof console.log=="function"&&(Array.prototype.unshift.call(arguments,"[Ajax Upload]"),console.log(Array.prototype.join.call(arguments," ")))}function b(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent("on"+b,function(){c.call(a)});else throw new Error("not supported or DOM not loaded")}function c(a){var c;b(window,"resize",function(){c&&clearTimeout(c),c=setTimeout(a,100)})}function e(a){var b,c,e,f,g=d(a);return b=g.left,e=g.top,c=b+a.offsetWidth,f=e+a.offsetHeight,{left:b,right:c,top:e,bottom:f}}function f(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])}function g(a,b){var c=e(a);f(b,{position:"absolute",left:c.left+"px",top:c.top+"px",width:a.offsetWidth+"px",height:a.offsetHeight+"px"})}function j(a){return a.replace(/.*(\/|\\)/,"")}function k(a){return-1!==a.indexOf(".")?a.replace(/.*[.]/,""):""}function l(a,b){var c=new RegExp("\\b"+b+"\\b");return c.test(a.className)}function m(a,b){l(a,b)||(a.className+=" "+b)}function n(a,b){var c=new RegExp("\\b"+b+"\\b");a.className=a.className.replace(c,"")}function o(a){a.parentNode.removeChild(a)}if(document.documentElement.getBoundingClientRect)var d=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0,h=1;if(d.getBoundingClientRect){var i=d.getBoundingClientRect();h=(i.right-i.left)/d.clientWidth}h>1&&(f=0,g=0);var j=b.top/h+(window.pageYOffset||e&&e.scrollTop/h||d.scrollTop/h)-f,k=b.left/h+(window.pageXOffset||e&&e.scrollLeft/h||d.scrollLeft/h)-g;return{top:j,left:k}};else var d=function(a){var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return{left:c,top:b}};var h=function(){var a=document.createElement("div");return function(b){a.innerHTML=b;var c=a.firstChild;return a.removeChild(c)}}(),i=function(){var a=0;return function(){return"ValumsAjaxUpload"+a++}}();window.AjaxUpload=function(a,c){this._settings={action:"upload.php",name:"userfile",data:{},autoSubmit:!0,responseType:!1,hoverClass:"hover",disabledClass:"disabled",onChange:function(a,b){},onSubmit:function(a,b){},onComplete:function(a,b){}};for(var d in c)c.hasOwnProperty(d)&&(this._settings[d]=c[d]);a.jquery?a=a[0]:typeof a=="string"&&(/^#.*/.test(a)&&(a=a.slice(1)),a=document.getElementById(a));if(!a||a.nodeType!==1)throw new Error("Please make sure that you're passing a valid element");a.nodeName.toUpperCase()=="A"&&b(a,"click",function(a){a&&a.preventDefault?a.preventDefault():window.event&&(window.event.returnValue=!1)}),this._button=a,this._input=null,this._disabled=!1,this.enable(),this._rerouteClicks()},AjaxUpload.prototype={setData:function(a){this._settings.data=a},disable:function(){m(this._button,this._settings.disabledClass),this._disabled=!0;var a=this._button.nodeName.toUpperCase();(a=="INPUT"||a=="BUTTON")&&this._button.setAttribute("disabled","disabled"),this._input&&(this._input.parentNode.style.visibility="hidden")},enable:function(){n(this._button,this._settings.disabledClass),this._button.removeAttribute("disabled"),this._disabled=!1},_createInput:function(){var a=this,c=document.createElement("input");c.setAttribute("type","file"),c.setAttribute("name",this._settings.name),f(c,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",cursor:"pointer"});var d=document.createElement("div");f(d,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583});if(d.style.opacity!=="0"){if(typeof d.filters=="undefined")throw new Error("Opacity not supported by the browser");d.style.filter="alpha(opacity=0)"}b(c,"change",function(){if(!c||c.value==="")return;var b=j(c.value);if(!1===a._settings.onChange.call(a,b,k(b))){a._clearInput();return}a._settings.autoSubmit&&a.submit()}),b(c,"mouseover",function(){m(a._button,a._settings.hoverClass)}),b(c,"mouseout",function(){n(a._button,a._settings.hoverClass),c.parentNode&&(c.parentNode.style.visibility="hidden")}),d.appendChild(c),document.body.appendChild(d),this._input=c},_clearInput:function(){if(!this._input)return;o(this._input.parentNode),this._input=null,this._createInput(),n(this._button,this._settings.hoverClass)},_rerouteClicks:function(){var a=this;b(a._button,"mouseover",function(){if(a._disabled)return;a._input||a._createInput();var b=a._input.parentNode;g(a._button,b),b.style.visibility="visible"})},_createIframe:function(){var a=i(),b=h('<iframe src="javascript:false;" name="'+a+'" />');return b.setAttribute("id",a),b.style.display="none",document.body.appendChild(b),b},_createForm:function(a){var b=this._settings,c=h('<form method="post" enctype="multipart/form-data"></form>');c.setAttribute("action",b.action),c.setAttribute("target",a.name),c.style.display="none",document.body.appendChild(c);for(var d in b.data)if(b.data.hasOwnProperty(d)){var e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("name",d),e.setAttribute("value",b.data[d]),c.appendChild(e)}return c},_getResponse:function(a,c){var d=!1,e=this,f=this._settings;b(a,"load",function(){var a;f.onComplete.call(e,c),d=!0})},submit:function(){var a=this,b=this._settings;if(!this._input||this._input.value==="")return;var c=j(this._input.value);if(!1===b.onSubmit.call(this,c,k(c))){this._clearInput();return}var d=this._createIframe(),e=this._createForm(d);o(this._input.parentNode),n(a._button,a._settings.hoverClass),e.appendChild(this._input),e.submit(),o(e),e=null,o(this._input),this._input=null,this._getResponse(d,c),this._createInput()}}})();var AIOUploader;AIOUploader=function(){function a(b,c){var d=this;this.selector=b,this.callback=c,this.uploader=new AjaxUpload($(this.selector)[0],{action:"http://chute.com:3000/v1/upload?shortcut="+this.currentShortcut+"&authorization="+a.token,name:"avatar",allowedExtensions:["jpg","jpeg","png","gif"],onSubmit:function(){return d.currentShortcut=d.shortcut(),d.uploader._settings.action="http://chute.com:3000/v1/upload?shortcut="+d.currentShortcut+"&authorization="+a.token},onComplete:function(){return d.callback(!1,"http://chute.com:3000/"+d.currentShortcut)}})}return a.token="",a.prototype.currentShortcut="",a.prototype.shortcut=function(){var a,b;b="u",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(;;){if(b.length===10)break;b+=a.charAt(Math.floor(Math.random()*a.length))}return b},a}();