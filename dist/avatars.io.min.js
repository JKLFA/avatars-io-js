/*! Avatars.io - v0.1.1 - 2012-08-07
* http://github.com/chute/avatars-io-js/
* Copyright (c) 2012 Vadim Demedes; Licensed MIT */
(function(){function a(){typeof console!="undefined"&&typeof console.log=="function"&&(Array.prototype.unshift.call(arguments,"[Ajax Upload]"),console.log(Array.prototype.join.call(arguments," ")))}function b(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent("on"+b,function(){c.call(a)});else throw new Error("not supported or DOM not loaded")}function c(a){var c;b(window,"resize",function(){c&&clearTimeout(c),c=setTimeout(a,100)})}function e(a){var b,c,e,f,g=d(a);return b=g.left,e=g.top,c=b+a.offsetWidth,f=e+a.offsetHeight,{left:b,right:c,top:e,bottom:f}}function f(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])}function g(a,b){var c=e(a);f(b,{position:"absolute",left:c.left+"px",top:c.top+"px",width:a.offsetWidth+"px",height:a.offsetHeight+"px"})}function j(a){return a.replace(/.*(\/|\\)/,"")}function k(a){return-1!==a.indexOf(".")?a.replace(/.*[.]/,""):""}function l(a,b){var c=new RegExp("\\b"+b+"\\b");return c.test(a.className)}function m(a,b){l(a,b)||(a.className+=" "+b)}function n(a,b){var c=new RegExp("\\b"+b+"\\b");a.className=a.className.replace(c,"")}function o(a){a.parentNode.removeChild(a)}if(document.documentElement.getBoundingClientRect)var d=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0,h=1;if(d.getBoundingClientRect){var i=d.getBoundingClientRect();h=(i.right-i.left)/d.clientWidth}h>1&&(f=0,g=0);var j=b.top/h+(window.pageYOffset||e&&e.scrollTop/h||d.scrollTop/h)-f,k=b.left/h+(window.pageXOffset||e&&e.scrollLeft/h||d.scrollLeft/h)-g;return{top:j,left:k}};else var d=function(a){var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return{left:c,top:b}};var h=function(){var a=document.createElement("div");return function(b){a.innerHTML=b;var c=a.firstChild;return a.removeChild(c)}}(),i=function(){var a=0;return function(){return"ValumsAjaxUpload"+a++}}();window.AjaxUpload=function(a,c){this._settings={action:"upload.php",name:"userfile",data:{},autoSubmit:!0,responseType:!1,hoverClass:"hover",disabledClass:"disabled",onChange:function(a,b){},onSubmit:function(a,b){},onComplete:function(a,b){}};for(var d in c)c.hasOwnProperty(d)&&(this._settings[d]=c[d]);a.jquery?a=a[0]:typeof a=="string"&&(/^#.*/.test(a)&&(a=a.slice(1)),a=document.getElementById(a));if(!a||a.nodeType!==1)throw new Error("Please make sure that you're passing a valid element");a.nodeName.toUpperCase()=="A"&&b(a,"click",function(a){a&&a.preventDefault?a.preventDefault():window.event&&(window.event.returnValue=!1)}),this._button=a,this._input=null,this._disabled=!1,this.enable(),this._rerouteClicks()},AjaxUpload.prototype={setData:function(a){this._settings.data=a},disable:function(){m(this._button,this._settings.disabledClass),this._disabled=!0;var a=this._button.nodeName.toUpperCase();(a=="INPUT"||a=="BUTTON")&&this._button.setAttribute("disabled","disabled"),this._input&&(this._input.parentNode.style.visibility="hidden")},enable:function(){n(this._button,this._settings.disabledClass),this._button.removeAttribute("disabled"),this._disabled=!1},_createInput:function(){var a=this,c=document.createElement("input");c.setAttribute("type","file"),c.setAttribute("name",this._settings.name),f(c,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",cursor:"pointer"});var d=document.createElement("div");f(d,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583});if(d.style.opacity!=="0"){if(typeof d.filters=="undefined")throw new Error("Opacity not supported by the browser");d.style.filter="alpha(opacity=0)"}b(c,"change",function(){if(!c||c.value==="")return;var b=j(c.value);if(!1===a._settings.onChange.call(a,b,k(b))){a._clearInput();return}a._settings.autoSubmit&&a.submit()}),b(c,"mouseover",function(){m(a._button,a._settings.hoverClass)}),b(c,"mouseout",function(){n(a._button,a._settings.hoverClass),c.parentNode&&(c.parentNode.style.visibility="hidden")}),d.appendChild(c),document.body.appendChild(d),this._input=c},_clearInput:function(){if(!this._input)return;o(this._input.parentNode),this._input=null,this._createInput(),n(this._button,this._settings.hoverClass)},_rerouteClicks:function(){var a=this;b(a._button,"mouseover",function(){if(a._disabled)return;a._input||a._createInput();var b=a._input.parentNode;g(a._button,b),b.style.visibility="visible"})},_createIframe:function(){return document.getElementsByTagName("iframe")[0]},_createForm:function(a){var b=this._settings,c=h('<form method="post" enctype="multipart/form-data"></form>');c.setAttribute("action",this._createIframe().getAttribute("src")),c.setAttribute("target",a.name),c.style.display="none",document.body.appendChild(c);for(var d in b.data)if(b.data.hasOwnProperty(d)){var e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("name",d),e.setAttribute("value",b.data[d]),c.appendChild(e)}return c},_getResponse:function(a,c){var d=!1,e=this,f=this._settings;b(a,"load",function(){var a;f.onComplete.call(e,c),d=!0})},submit:function(){var a=this,b=this._settings;if(!this._input||this._input.value==="")return;var c=j(this._input.value);if(!1===b.onSubmit.call(this,c,k(c))){this._clearInput();return}if(-1==this._settings.allowedExtensions.indexOf(k(this._input.value)))return alert("Only "+this._settings.allowedExtensions.join(", ")+" "+(this._settings.allowedExtensions.length==1?"is":"are")+" allowed");var d=this._createIframe(),e=this._createForm(d);o(this._input.parentNode),n(a._button,a._settings.hoverClass),e.appendChild(this._input),e.submit(),this._getResponse(d,c),this._createInput()}}})(),function(a,b,c,d,e,f){function u(a,b){var c=typeof a[b];return c=="function"||c=="object"&&!!a[b]||c=="unknown"}function v(a,b){return typeof a[b]=="object"&&!!a[b]}function w(a){return Object.prototype.toString.call(a)==="[object Array]"}function x(){var a="Shockwave Flash",b="application/x-shockwave-flash";if(!O(navigator.plugins)&&typeof navigator.plugins[a]=="object"){var c=navigator.plugins[a].description;c&&!O(navigator.mimeTypes)&&navigator.mimeTypes[b]&&navigator.mimeTypes[b].enabledPlugin&&(s=c.match(/\d+/g))}if(!s){var d;try{d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),s=Array.prototype.slice.call(d.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),d=null}catch(e){}}if(!s)return!1;var f=parseInt(s[0],10),g=parseInt(s[1],10);return t=f>9&&g>0,!0}function D(){if(A)return;A=!0;for(var a=0;a<B.length;a++)B[a]();B.length=0}function F(a,b){if(A){a.call(b);return}B.push(function(){a.call(b)})}function G(){var a=parent;if(m!=="")for(var b=0,c=m.split(".");b<c.length;b++)a=a[c[b]];return a.easyXDM}function H(b){return a.easyXDM=o,m=b,m&&(p="easyXDM_"+m.replace(".","_")+"_"),n}function I(a){return a.match(j)[3]}function J(a){return a.match(j)[4]||""}function K(a){var b=a.toLowerCase().match(j),c=b[2],d=b[3],e=b[4]||"";if(c=="http:"&&e==":80"||c=="https:"&&e==":443")e="";return c+"//"+d+e}function L(a){a=a.replace(l,"$1/");if(!a.match(/^(http||https):\/\//)){var b=a.substring(0,1)==="/"?"":c.pathname;b.substring(b.length-1)!=="/"&&(b=b.substring(0,b.lastIndexOf("/")+1)),a=c.protocol+"//"+c.host+b+a}while(k.test(a))a=a.replace(k,"");return a}function M(a,b){var c="",d=a.indexOf("#");d!==-1&&(c=a.substring(d),a=a.substring(0,d));var e=[];for(var g in b)b.hasOwnProperty(g)&&e.push(g+"="+f(b[g]));return a+(r?"#":a.indexOf("?")==-1?"?":"&")+e.join("&")+c}function O(a){return typeof a=="undefined"}function Q(a,b,c){var d;for(var e in b)b.hasOwnProperty(e)&&(e in a?(d=b[e],typeof d=="object"?Q(a[e],d,c):c||(a[e]=b[e])):a[e]=b[e]);return a}function R(){var a=b.body.appendChild(b.createElement("form")),c=a.appendChild(b.createElement("input"));c.name=p+"TEST"+h,q=c!==a.elements[c.name],b.body.removeChild(a)}function S(a){O(q)&&R();var c;q?c=b.createElement('<iframe name="'+a.props.name+'"/>'):(c=b.createElement("IFRAME"),c.name=a.props.name),c.id=c.name=a.props.name,delete a.props.name,typeof a.container=="string"&&(a.container=b.getElementById(a.container)),a.container||(Q(c.style,{position:"absolute",top:"-2000px",left:"0px"}),a.container=b.body);var d=a.props.src;a.props.src="javascript:false",Q(c,a.props),c.border=c.frameBorder=0,c.allowTransparency=!0,a.container.appendChild(c),a.onLoad&&y(c,"load",a.onLoad);if(a.usePost){var e=a.container.appendChild(b.createElement("form")),f;e.target=c.name,e.action=d,e.method="POST";if(typeof a.usePost=="object")for(var g in a.usePost)a.usePost.hasOwnProperty(g)&&(q?f=b.createElement('<input name="'+g+'"/>'):(f=b.createElement("INPUT"),f.name=g),f.value=a.usePost[g],e.appendChild(f));e.submit(),e.parentNode.removeChild(e)}else c.src=d;return a.props.src=d,c}function T(a,b){typeof a=="string"&&(a=[a]);var c,d=a.length;while(d--){c=a[d],c=new RegExp(c.substr(0,1)=="^"?c:"^"+c.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$");if(c.test(b))return!0}return!1}function U(d){var e=d.protocol,f;d.isHost=d.isHost||O(N.xdm_p),r=d.hash||!1,d.props||(d.props={});if(!d.isHost){d.channel=N.xdm_c.replace(/["'<>\\]/g,""),d.secret=N.xdm_s,d.remote=N.xdm_e.replace(/["'<>\\]/g,""),e=N.xdm_p;if(d.acl&&!T(d.acl,d.remote))throw new Error("Access denied for "+d.remote)}else d.remote=L(d.remote),d.channel=d.channel||"default"+h++,d.secret=Math.random().toString(16).substring(2),O(e)&&(K(c.href)==K(d.remote)?e="4":u(a,"postMessage")||u(b,"postMessage")?e="1":d.swf&&u(a,"ActiveXObject")&&x()?e="6":navigator.product==="Gecko"&&"frameElement"in a&&navigator.userAgent.indexOf("WebKit")==-1?e="5":d.remoteHelper?e="2":e="0");d.protocol=e;switch(e){case"0":Q(d,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0);if(d.isHost){if(!d.local){var g=c.protocol+"//"+c.host,i=b.body.getElementsByTagName("img"),j,k=i.length;while(k--){j=i[k];if(j.src.substring(0,g.length)===g){d.local=j.src;break}}d.local||(d.local=a)}var l={xdm_c:d.channel,xdm_p:0};d.local===a?(d.usePolling=!0,d.useParent=!0,d.local=c.protocol+"//"+c.host+c.pathname+c.search,l.xdm_e=d.local,l.xdm_pa=1):l.xdm_e=L(d.local),d.container&&(d.useResize=!1,l.xdm_po=1),d.remote=M(d.remote,l)}else Q(d,{channel:N.xdm_c,remote:N.xdm_e,useParent:!O(N.xdm_pa),usePolling:!O(N.xdm_po),useResize:d.useParent?!1:d.useResize});f=[new n.stack.HashTransport(d),new n.stack.ReliableBehavior({}),new n.stack.QueueBehavior({encode:!0,maxLength:4e3-d.remote.length}),new n.stack.VerifyBehavior({initiate:d.isHost})];break;case"1":f=[new n.stack.PostMessageTransport(d)];break;case"2":d.remoteHelper=L(d.remoteHelper),f=[new n.stack.NameTransport(d),new n.stack.QueueBehavior,new n.stack.VerifyBehavior({initiate:d.isHost})];break;case"3":f=[new n.stack.NixTransport(d)];break;case"4":f=[new n.stack.SameOriginTransport(d)];break;case"5":f=[new n.stack.FrameElementTransport(d)];break;case"6":s||x(),f=[new n.stack.FlashTransport(d)]}return f.push(new n.stack.QueueBehavior({lazy:d.lazy,remove:!0})),f}function V(a){var b,c={incoming:function(a,b){this.up.incoming(a,b)},outgoing:function(a,b){this.down.outgoing(a,b)},callback:function(a){this.up.callback(a)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}};for(var d=0,e=a.length;d<e;d++)b=a[d],Q(b,c,!0),d!==0&&(b.down=a[d-1]),d!==e-1&&(b.up=a[d+1]);return b}function W(a){a.up.down=a.down,a.down.up=a.up,a.up=a.down=null}var g=this,h=Math.floor(Math.random()*1e4),i=Function.prototype,j=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,k=/[\-\w]+\/\.\.\//,l=/([^:])\/\//g,m="",n={},o=a.easyXDM,p="easyXDM_",q,r=!1,s,t,y,z;if(u(a,"addEventListener"))y=function(a,b,c){a.addEventListener(b,c,!1)},z=function(a,b,c){a.removeEventListener(b,c,!1)};else if(u(a,"attachEvent"))y=function(a,b,c){a.attachEvent("on"+b,c)},z=function(a,b,c){a.detachEvent("on"+b,c)};else throw new Error("Browser not supported");var A=!1,B=[],C;"readyState"in b?(C=b.readyState,A=C=="complete"||~navigator.userAgent.indexOf("AppleWebKit/")&&(C=="loaded"||C=="interactive")):A=!!b.body;if(!A){if(u(a,"addEventListener"))y(b,"DOMContentLoaded",D);else{y(b,"readystatechange",function(){b.readyState=="complete"&&D()});if(b.documentElement.doScroll&&a===top){var E=function(){if(A)return;try{b.documentElement.doScroll("left")}catch(a){d(E,1);return}D()};E()}}y(a,"load",D)}var N=function(a){a=a.substring(1).split("&");var b={},c,d=a.length;while(d--)c=a[d].split("="),b[c[0]]=e(c[1]);return b}(/xdm_e=/.test(c.search)?c.search:c.hash),P=function(){var a={},b={a:[1,2,3]},c='{"a":[1,2,3]}';return typeof JSON!="undefined"&&typeof JSON.stringify=="function"&&JSON.stringify(b).replace(/\s/g,"")===c?JSON:(Object.toJSON&&Object.toJSON(b).replace(/\s/g,"")===c&&(a.stringify=Object.toJSON),typeof String.prototype.evalJSON=="function"&&(b=c.evalJSON(),b.a&&b.a.length===3&&b.a[2]===3&&(a.parse=function(a){return a.evalJSON()})),a.stringify&&a.parse?(P=function(){return a},a):null)};Q(n,{version:"2.4.15.0",query:N,stack:{},apply:Q,getJSONObject:P,whenReady:F,noConflict:H}),n.DomHelper={on:y,un:z,requiresJSON:function(c){v(a,"JSON")||b.write('<script type="text/javascript" src="'+c+'"><'+"/script>")}},function(){var a={};n.Fn={set:function(b,c){a[b]=c},get:function(b,c){var d=a[b];return c&&delete a[b],d}}}(),n.Socket=function(a){var b=V(U(a).concat([{incoming:function(b,c){a.onMessage(b,c)},callback:function(b){a.onReady&&a.onReady(b)}}])),c=K(a.remote);this.origin=K(a.remote),this.destroy=function(){b.destroy()},this.postMessage=function(a){b.outgoing(a,c)},b.init()},n.Rpc=function(a,b){if(b.local)for(var c in b.local)if(b.local.hasOwnProperty(c)){var d=b.local[c];typeof d=="function"&&(b.local[c]={method:d})}var e=V(U(a).concat([new n.stack.RpcBehavior(this,b),{callback:function(b){a.onReady&&a.onReady(b)}}]));this.origin=K(a.remote),this.destroy=function(){e.destroy()},e.init()},n.stack.SameOriginTransport=function(a){var b,e,f,g;return b={outgoing:function(a,b,c){f(a),c&&c()},destroy:function(){e&&(e.parentNode.removeChild(e),e=null)},onDOMReady:function(){g=K(a.remote),a.isHost?(Q(a.props,{src:M(a.remote,{xdm_e:c.protocol+"//"+c.host+c.pathname,xdm_c:a.channel,xdm_p:4}),name:p+a.channel+"_provider"}),e=S(a),n.Fn.set(a.channel,function(a){return f=a,d(function(){b.up.callback(!0)},0),function(a){b.up.incoming(a,g)}})):(f=G().Fn.get(a.channel,!0)(function(a){b.up.incoming(a,g)}),d(function(){b.up.callback(!0)},0))},init:function(){F(b.onDOMReady,b)}}},n.stack.FlashTransport=function(a){function l(a,b){d(function(){e.up.incoming(a,i)},0)}function o(c){var d=a.swf+"?host="+a.isHost,e="easyXDM_swf_"+Math.floor(Math.random()*1e4);n.Fn.set("flash_loaded"+c.replace(/[\-.]/g,"_"),function(){n.stack.FlashTransport[c].swf=j=k.firstChild;var a=n.stack.FlashTransport[c].queue;for(var b=0;b<a.length;b++)a[b]();a.length=0}),a.swfContainer?k=typeof a.swfContainer=="string"?b.getElementById(a.swfContainer):a.swfContainer:(k=b.createElement("div"),Q(k.style,t&&a.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),b.body.appendChild(k));var f="callback=flash_loaded"+c.replace(/[\-.]/g,"_")+"&proto="+g.location.protocol+"&domain="+I(g.location.href)+"&port="+J(g.location.href)+"&ns="+m;k.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+e+"' data='"+d+"'>"+"<param name='allowScriptAccess' value='always'></param>"+"<param name='wmode' value='transparent'>"+"<param name='movie' value='"+d+"'></param>"+"<param name='flashvars' value='"+f+"'></param>"+"<embed type='application/x-shockwave-flash' FlashVars='"+f+"' allowScriptAccess='always' wmode='transparent' src='"+d+"' height='1' width='1'></embed>"+"</object>"}var e,f,h,i,j,k;return e={outgoing:function(b,c,d){j.postMessage(a.channel,b.toString()),d&&d()},destroy:function(){try{j.destroyChannel(a.channel)}catch(b){}j=null,f&&(f.parentNode.removeChild(f),f=null)},onDOMReady:function(){i=a.remote,n.Fn.set("flash_"+a.channel+"_init",function(){d(function(){e.up.callback(!0)})}),n.Fn.set("flash_"+a.channel+"_onMessage",l),a.swf=L(a.swf);var b=I(a.swf),g=function(){n.stack.FlashTransport[b].init=!0,j=n.stack.FlashTransport[b].swf,j.createChannel(a.channel,a.secret,K(a.remote),a.isHost),a.isHost&&(t&&a.swfNoThrottle&&Q(a.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),Q(a.props,{src:M(a.remote,{xdm_e:K(c.href),xdm_c:a.channel,xdm_p:6,xdm_s:a.secret}),name:p+a.channel+"_provider"}),f=S(a))};n.stack.FlashTransport[b]&&n.stack.FlashTransport[b].init?g():n.stack.FlashTransport[b]?n.stack.FlashTransport[b].queue.push(g):(n.stack.FlashTransport[b]={queue:[g]},o(b))},init:function(){F(e.onDOMReady,e)}}},n.stack.PostMessageTransport=function(b){function i(a){if(a.origin)return K(a.origin);if(a.uri)return K(a.uri);if(a.domain)return c.protocol+"//"+a.domain;throw"Unable to retrieve the origin of the event"}function j(a){var c=i(a);c==h&&a.data.substring(0,b.channel.length+1)==b.channel+" "&&e.up.incoming(a.data.substring(b.channel.length+1),c)}var e,f,g,h;return e={outgoing:function(a,c,d){g.postMessage(b.channel+" "+a,c||h),d&&d()},destroy:function(){z(a,"message",j),f&&(g=null,f.parentNode.removeChild(f),f=null)},onDOMReady:function(){h=K(b.remote);if(b.isHost){var i=function(c){c.data==b.channel+"-ready"&&(g="postMessage"in f.contentWindow?f.contentWindow:f.contentWindow.document,z(a,"message",i),y(a,"message",j),d(function(){e.up.callback(!0)},0))};y(a,"message",i),Q(b.props,{src:M(b.remote,{xdm_e:K(c.href),xdm_c:b.channel,xdm_p:1}),name:p+b.channel+"_provider"}),f=S(b)}else y(a,"message",j),g="postMessage"in a.parent?a.parent:a.parent.document,g.postMessage(b.channel+"-ready",h),d(function(){e.up.callback(!0)},0)},init:function(){F(e.onDOMReady,e)}}},n.stack.FrameElementTransport=function(e){var f,g,h,i;return f={outgoing:function(a,b,c){h.call(this,a),c&&c()},destroy:function(){g&&(g.parentNode.removeChild(g),g=null)},onDOMReady:function(){i=K(e.remote),e.isHost?(Q(e.props,{src:M(e.remote,{xdm_e:K(c.href),xdm_c:e.channel,xdm_p:5}),name:p+e.channel+"_provider"}),g=S(e),g.fn=function(a){return delete g.fn,h=a,d(function(){f.up.callback(!0)},0),function(a){f.up.incoming(a,i)}}):(b.referrer&&K(b.referrer)!=N.xdm_e&&(a.top.location=N.xdm_e),h=a.frameElement.fn(function(a){f.up.incoming(a,i)}),f.up.callback(!0))},init:function(){F(f.onDOMReady,f)}}},n.stack.NameTransport=function(a){function k(b){var d=a.remoteHelper+(c?"#_3":"#_2")+a.channel;e.contentWindow.sendMessage(b,d)}function l(){c?(++g===2||!c)&&b.up.callback(!0):(k("ready"),b.up.callback(!0))}function m(a){b.up.incoming(a,i)}function o(){h&&d(function(){h(!0)},0)}var b,c,e,f,g,h,i,j;return b={outgoing:function(a,b,c){h=c,k(a)},destroy:function(){e.parentNode.removeChild(e),e=null,c&&(f.parentNode.removeChild(f),f=null)},onDOMReady:function(){c=a.isHost,g=0,i=K(a.remote),a.local=L(a.local),c?(n.Fn.set(a.channel,function(b){c&&b==="ready"&&(n.Fn.set(a.channel,m),l())}),j=M(a.remote,{xdm_e:a.local,xdm_c:a.channel,xdm_p:2}),Q(a.props,{src:j+"#"+a.channel,name:p+a.channel+"_provider"}),f=S(a)):(a.remoteHelper=a.remote,n.Fn.set(a.channel,m));var b=function(){var c=e||this;z(c,"load",b),n.Fn.set(a.channel+"_load",o),function f(){typeof c.contentWindow.sendMessage=="function"?l():d(f,50)}()};e=S({props:{src:a.local+"#_4"+a.channel},onLoad:b})},init:function(){F(b.onDOMReady,b)}}},n.stack.HashTransport=function(b){function o(a){if(!l)return;var c=b.remote+"#"+j++ +"_"+a;(f||!m?l.contentWindow:l).location=c}function q(a){i=a,c.up.incoming(i.substring(i.indexOf("_")+1),n)}function r(){if(!k)return;var a=k.location.href,b="",c=a.indexOf("#");c!=-1&&(b=a.substring(c)),b&&b!=i&&q(b)}function s(){g=setInterval(r,h)}var c,e=this,f,g,h,i,j,k,l,m,n;return c={outgoing:function(a,b){o(a)},destroy:function(){a.clearInterval(g),(f||!m)&&l.parentNode.removeChild(l),l=null},onDOMReady:function(){f=b.isHost,h=b.interval,i="#"+b.channel,j=0,m=b.useParent,n=K(b.remote);if(f){Q(b.props,{src:b.remote,name:p+b.channel+"_provider"});if(m)b.onLoad=function(){k=a,s(),c.up.callback(!0)};else{var e=0,g=b.delay/50;(function o(){if(++e>g)throw new Error("Unable to reference listenerwindow");try{k=l.contentWindow.frames[p+b.channel+"_consumer"]}catch(a){}k?(s(),c.up.callback(!0)):d(o,50)})()}l=S(b)}else k=a,s(),m?(l=parent,c.up.callback(!0)):(Q(b,{props:{src:b.remote+"#"+b.channel+new Date,name:p+b.channel+"_consumer"},onLoad:function(){c.up.callback(!0)}}),l=S(b))},init:function(){F(c.onDOMReady,c)}}},n.stack.ReliableBehavior=function(a){var b,c,d=0,e=0,f="";return b={incoming:function(a,g){var h=a.indexOf("_"),i=a.substring(0,h).split(",");a=a.substring(h+1),i[0]==d&&(f="",c&&(c(!0),c=null)),a.length>0&&(b.down.outgoing(i[1]+","+d+"_"+f,g),e!=i[1]&&(e=i[1],b.up.incoming(a,g)))},outgoing:function(a,g,h){f=a,c=h,b.down.outgoing(e+","+ ++d+"_"+a,g)}}},n.stack.QueueBehavior=function(a){function m(){if(a.remove&&c.length===0){W(b);return}if(g||c.length===0||i)return;g=!0;var e=c.shift();b.down.outgoing(e.data,e.origin,function(a){g=!1,e.callback&&d(function(){e.callback(a)},0),m()})}var b,c=[],g=!0,h="",i,j=0,k=!1,l=!1;return b={init:function(){O(a)&&(a={}),a.maxLength&&(j=a.maxLength,l=!0),a.lazy?k=!0:b.down.init()},callback:function(a){g=!1;var c=b.up;m(),c.callback(a)},incoming:function(c,d){if(l){var f=c.indexOf("_"),g=parseInt(c.substring(0,f),10);h+=c.substring(f+1),g===0&&(a.encode&&(h=e(h)),b.up.incoming(h,d),h="")}else b.up.incoming(c,d)},outgoing:function(d,e,g){a.encode&&(d=f(d));var h=[],i;if(l){while(d.length!==0)i=d.substring(0,j),d=d.substring(i.length),h.push(i);while(i=h.shift())c.push({data:h.length+"_"+i,origin:e,callback:h.length===0?g:null})}else c.push({data:d,origin:e,callback:g});k?b.down.init():m()},destroy:function(){i=!0,b.down.destroy()}}},n.stack.VerifyBehavior=function(a){function f(){c=Math.random().toString(16).substring(2),b.down.outgoing(c)}var b,c,d,e=!1;return b={incoming:function(e,g){var h=e.indexOf("_");h===-1?e===c?b.up.callback(!0):d||(d=e,a.initiate||f(),b.down.outgoing(e)):e.substring(0,h)===d&&b.up.incoming(e.substring(h+1),g)},outgoing:function(a,d,e){b.down.outgoing(c+"_"+a,d,e)},callback:function(b){a.initiate&&f()}}},n.stack.RpcBehavior=function(a,b){function g(a){a.jsonrpc="2.0",c.down.outgoing(d.stringify(a))}function h(a,b){var c=Array.prototype.slice;return function(){var d=arguments.length,h,i={method:b};d>0&&typeof arguments[d-1]=="function"?(d>1&&typeof arguments[d-2]=="function"?(h={success:arguments[d-2],error:arguments[d-1]},i.params=c.call(arguments,0,d-2)):(h={success:arguments[d-1]},i.params=c.call(arguments,0,d-1)),f[""+ ++e]=h,i.id=e):i.params=c.call(arguments,0),a.namedParams&&i.params.length===1&&(i.params=i.params[0]),g(i)}}function j(a,b,c,d){if(!c){b&&g({id:b,error:{code:-32601,message:"Procedure not found."}});return}var e,f;b?(e=function(a){e=i,g({id:b,result:a})},f=function(a,c){f=i;var d={id:b,error:{code:-32099,message:a}};c&&(d.error.data=c),g(d)}):e=f=i,w(d)||(d=[d]);try{var h=c.method.apply(c.scope,d.concat([e,f]));O(h)||e(h)}catch(j){f(j.message)}}var c,d=b.serializer||P(),e=0,f={};return c={incoming:function(a,c){var e=d.parse(a);if(e.method)b.handle?b.handle(e,g):j(e.method,e.id,b.local[e.method],e.params);else{var h=f[e.id];e.error?h.error&&h.error(e.error):h.success&&h.success(e.result),delete f[e.id]}},init:function(){if(b.remote)for(var d in b.remote)b.remote.hasOwnProperty(d)&&(a[d]=h(b.remote[d],d));c.down.init()},destroy:function(){for(var d in b.remote)b.remote.hasOwnProperty(d)&&a.hasOwnProperty(d)&&delete a[d];c.down.destroy()}}},g.easyXDM=n}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);var AvatarsIO;AvatarsIO=function(){function a(a){this.token=a}return a.prototype.create=function(b){return new a.Uploader(this.token,b)},a}(),AvatarsIO.Uploader=function(){function a(a,b){this.token=a,this.input=b,this.initialize(),this.emit("init")}return a.prototype.listeners={},a.prototype.identifier="",a.prototype.allowedExtensions=["jpg","jpeg","png","gif"],a.prototype.initialize=function(){var a,b=this;a="http://avatars.io/v1/upload?authorization="+this.token+(this.identifier.length>0?"&shortcut="+this.identifier:""),this.socket=new easyXDM.Socket({remote:a,onMessage:function(a,c){return b.emit("complete",a)}});if(!this.widget)return this.widget=new AjaxUpload(this.input,{action:a,name:"avatar",allowedExtensions:this.allowedExtensions,onSubmit:function(){return b.emit("new")}})},a.prototype.setAlbum=function(a){var b=this;return this.identifier=a!=null?a:"",setTimeout(function(){return b.socket&&b.socket.destroy(),b.initialize()},100)},a.prototype.setAlbumID=function(){return this.setAlbum.apply(this,arguments)},a.prototype.setAllowedExtensions=function(a){this.allowedExtensions=a!=null?a:[];if(this.widget)return this.widget._settings.allowedExtensions=this.allowedExtensions},a.prototype.on=function(a,b){return this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b)},a.prototype.emit=function(a,b,c){var d,e,f,g;c==null&&(c=this);if(!this.listeners[a])return;g=this.listeners[a];for(e=0,f=g.length;e<f;e++)d=g[e],d.apply(c,[b]);return void 0},a}();